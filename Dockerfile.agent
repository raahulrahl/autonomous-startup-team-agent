# Dockerfile.agent
#
# Multi-stage build for a Bindu agent (airbnb-travel-agent example).
# Builder: python:3.12-bookworm + uv
# Runtime: bindu-runtime-base

# ---------- Builder stage ----------
FROM python:3.12-bookworm AS builder

# Install uv once in builder (no need in runtime)
RUN pip install --no-cache-dir uv

ENV UV_COMPILE_BYTECODE=1 UV_LINK_MODE=copy
WORKDIR /app

# 1) Install dependencies into .venv (lockfile + pyproject)
COPY pyproject.toml uv.lock ./
RUN uv sync --frozen --no-install-project --no-dev

# 2) Copy agent code
COPY autonomous_startup_team_agent/ /app/autonomous_startup_team_agent/
COPY *.py /app/
COPY README.md /app/

# 3) Install project itself into the same venv
RUN uv sync --frozen --no-dev

# ---------- Runtime stage ----------
FROM raahulrahl/bindu-runtime-base:latest

# OCI labels
LABEL org.opencontainers.image.title="autonomous-startup-team-agent"
LABEL org.opencontainers.image.description="A multi-agent Agno Team that simulates an autonomous startup workforce. Specialized AI agents (e.g., Product Manager, Market Research, Sales, Legal, Finance, Support) coordinate under a CEO agent to self-organize tasks, make strategic decisions, and drive product development, market analysis, compliance, sales execution, and customer support. Built with Agnoâ€™s team orchestration, shared knowledge, and tool integrations, it showcases scalable AI collaboration for complex, real-world business workflows."
LABEL org.opencontainers.image.authors="raahul <raahul@getbindu.com>"
LABEL org.opencontainers.image.version="1.0.0"
LABEL org.opencontainers.image.source="https://github.com/raahulrahl/autonomous-startup-team-agent"
LABEL org.opencontainers.image.licenses="MIT"

# Copy app + venv from builder
COPY --from=builder /app /app

# Use the agent venv Python by default
ENV PATH="/app/.venv/bin:$PATH"

WORKDIR /app
EXPOSE 3773

CMD ["python", "-m", "autonomous_startup_team_agent"]
